# 🏠 Notion 頁面監控系統使用指南

## 🎯 系統概述

這是一個完全自動化的 Notion 頁面監控系統，專門為您的租屋需求設計：

- 🔍 **自動監控**: 每 5 分鐘檢查指定 Notion 頁面的新增連結
- 🤖 **智能處理**: AI 自動提取 591 房源資訊並評分
- 📊 **自動篩選**: 只處理評分 60 分以上的優質房源
- 📝 **自動記錄**: 所有處理過程自動簽名並記錄時間
- 🗄️ **自動歸檔**: 符合條件的房源自動添加到租屋資料庫

## 📋 監控目標

- **監控頁面**: https://www.notion.so/22cb86cbe9ad80a18fbcca277054512a
- **目標資料庫**: https://www.notion.so/227b86cbe9ad806b9096f90af9094dba
- **處理者簽名**: Augment Agent 🤖

## 🚀 使用方式

### 1. 啟動監控系統

```bash
# 啟動完整監控系統
npm run monitor

# 開發模式（自動重啟）
npm run monitor:dev

# 查看監控日誌
npm run logs:monitor
```

### 2. 添加房源連結

在監控頁面 (https://www.notion.so/22cb86cbe9ad80a18fbcca277054512a) 中：

1. **直接貼上 591 連結**
   ```
   https://rent.591.com.tw/rent-detail-12345678.html
   ```

2. **使用書籤區塊**
   - 在頁面中添加 `/bookmark`
   - 貼上 591 連結

3. **在段落中添加連結**
   - 選擇文字 → 添加連結 → 貼上 591 URL

### 3. 系統自動處理流程

1. **檢測新連結** (每 5 分鐘)
2. **提取房源資訊** (標題、價格、地址等)
3. **智能評分** (基於您的租屋需求)
4. **篩選處理** (60 分以上才會處理)
5. **寫入資料庫** (自動映射到 23 個欄位)
6. **記錄簽名** (處理時間和處理者)

## 📊 評分標準

系統會根據您的租屋需求自動評分 (總分 110 分)：

### ✅ 加分項目
- **價格合理** (25分): 雅房 ≤$10,000 / 套房 ≤$15,000
- **必要設備** (40分): 變頻冷氣、冰箱、對外窗、洗衣機
- **地理位置** (20分): 台北市、新北市優質區域
- **加分特色** (15分): 露台、乾淨整潔、友善環境
- **寵物友善** (10分): 可養寵物

### ❌ 排除條件 (直接 0 分)
- 無對外窗
- 老舊壁癌
- 糟糕浴室
- 隔音差
- 禁止寵物

## 📝 處理記錄格式

每個處理的連結都會在監控頁面自動添加記錄：

```
✅ 成功 | https://rent.591.com.tw/example | 2025-07-10 下午8:45:23 | Augment Agent 🤖 | 資料庫頁面: https://www.notion.so/page-id | 評分: 85/100
```

## 🗄️ 資料庫欄位映射

系統會自動將房源資訊映射到以下欄位：

### 核心資訊
- **房源名稱**: 自動提取標題
- **租金**: 自動識別價格
- **房型**: 智能判斷 (獨立套房/分租套房/雅房等)
- **地址**: 完整地址資訊
- **區域名稱**: 自動解析區域
- **市區名稱**: 自動解析城市

### 評估資訊
- **適合度**: AI 評估結果 (非常適合/很適合/適合等)
- **平均評分**: 轉換為 5 分制評分
- **重要優勢**: AI 生成的優勢摘要
- **看房狀態**: 預設為「未聯繫」

### 詳細資訊
- **設備與特色**: 自動識別設備清單
- **交通便利性**: AI 分析交通狀況
- **生活機能**: AI 分析周邊生活機能
- **公共設施及空間**: 大樓公共設施

### 聯繫與管理
- **房東聯繫方式**: 自動提取聯絡資訊
- **網頁連結**: 原始 591 連結
- **備註**: 包含處理資訊和簽名
- **簽約注意事項**: 監控來源頁面連結
- **更新日期**: 自動記錄處理時間

## 🔧 系統配置

### 環境變數設定 (.env)
```env
# Notion API 設定
NOTION_API_KEY=your_notion_api_key
NOTION_DATABASE_ID=227b86cbe9ad806b9096f90af9094dba

# 監控設定
MIN_SCORE_THRESHOLD=60
MAX_BUDGET_SUITE=15000
MAX_BUDGET_ROOM=10000
MAX_MRT_DISTANCE=15

# 日誌設定
LOG_LEVEL=info
```

### 監控間隔調整
在 `src/monitorApp.js` 中修改：
```javascript
checkInterval: '*/5 * * * *', // 每 5 分鐘
// 其他選項：
// '*/1 * * * *'  // 每 1 分鐘
// '*/10 * * * *' // 每 10 分鐘
// '0 */1 * * *'  // 每小時
```

## 📊 監控統計

系統會自動記錄以下統計資訊：
- 總檢查次數
- 發現連結數量
- 處理連結數量
- 成功處理數量
- 系統運行時間

## 🛠️ 故障排除

### 常見問題

1. **連結沒有被處理**
   - 確認是有效的 591 租屋連結
   - 檢查評分是否低於 60 分門檻
   - 查看監控日誌: `npm run logs:monitor`

2. **系統沒有檢測到新連結**
   - 確認連結格式正確
   - 檢查是否為重複連結
   - 重新啟動監控系統

3. **Notion 寫入失敗**
   - 檢查 API Key 是否有效
   - 確認 Integration 已加入資料庫
   - 檢查網路連接

### 日誌查看
```bash
# 查看即時日誌
npm run logs:monitor

# 查看完整日誌檔案
cat logs/monitor-app.log

# 搜尋錯誤
grep "ERROR" logs/monitor-app.log
```

## 🎯 最佳實踐

### 1. 連結添加建議
- 一次添加 1-3 個連結，避免系統負載過重
- 使用書籤區塊可以獲得更好的連結識別效果
- 添加連結後等待 5-10 分鐘查看處理結果

### 2. 監控頁面管理
- 定期清理已處理的連結記錄
- 保持頁面整潔，便於查看處理狀態
- 可以添加分類標題組織不同來源的連結

### 3. 資料庫維護
- 定期檢查「未聯繫」狀態的房源
- 更新看房狀態和備註
- 刪除不再需要的房源記錄

## 🆘 技術支援

如遇到問題，請：
1. 查看日誌檔案
2. 檢查系統配置
3. 重新啟動監控系統
4. 聯繫技術支援

---

**系統開發**: Augment Agent 🤖  
**最後更新**: 2025-07-10  
**版本**: 1.0.0
